RewriteEngine On

# Configuration spécifique OVH
Options +FollowSymLinks -MultiViews

# Headers pour CORS (nécessaire pour OVH)
<IfModule mod_headers.c>
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
</IfModule>

# Gestion des requêtes OPTIONS pour CORS
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# Rediriger les URLs avec .html vers les URLs propres (sauf fichiers de diagnostic)
RewriteCond %{THE_REQUEST} \s/+(.+)\.html[\s?] [NC]
RewriteCond %{REQUEST_URI} !^/(debug-ovh|test-assets)\.html$ [NC]
RewriteRule ^(.+)\.html$ /$1? [R=301,L]

# Servir les fichiers statiques et assets normalement
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Servir les dossiers normalement
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Permettre l'accès aux pages de diagnostic
RewriteRule ^(debug-ovh|test-assets)\.html$ tests/$0 [L]

# Endpoints PHP backend
RewriteRule ^process-order\.php$ backend/php/process-order.php [L]
RewriteRule ^process-contact\.php$ backend/php/process-contact.php [L]

# Page d'accueil
RewriteRule ^$ frontend/index.html [L]
RewriteRule ^home/?$ /frontend/index.html [NC,L]

# Pages principales → frontend/
RewriteRule ^essential/?$ frontend/essential.html [NC,L]
RewriteRule ^business/?$ frontend/business.html [NC,L]
RewriteRule ^enterprise/?$ frontend/enterprise.html [NC,L]
RewriteRule ^contact/?$ frontend/contact.html [NC,L]
RewriteRule ^blog/?$ frontend/blog.html [NC,L]
RewriteRule ^a-propos/?$ frontend/a-propos.html [NC,L]
RewriteRule ^simulateur/?$ frontend/simulateur.html [NC,L]
RewriteRule ^logos/?$ frontend/logos.html [NC,L]

# Gestion des erreurs 404
ErrorDocument 404 /frontend/404.html

# Désactiver l'affichage du contenu des dossiers
Options -Indexes

# Cache et compression pour les performances
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"
</IfModule>

<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Sécurité
<Files ~ "^\.ht">
    Order allow,deny
    Deny from all
</Files>

# Empêcher l'accès aux fichiers de configuration
<Files "config.php">
    Order allow,deny
    Deny from all
</Files>

<Files "*.md">
    Order allow,deny
    Deny from all
</Files>