RewriteEngine On

# Configuration spécifique OVH
Options +FollowSymLinks -MultiViews

# Headers pour CORS (nécessaire pour OVH)
<IfModule mod_headers.c>
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
</IfModule>

# Gestion des requêtes OPTIONS pour CORS
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# Rediriger les URLs avec .html vers les URLs propres
RewriteCond %{THE_REQUEST} \s/+(.+)\.html[\s?] [NC]
RewriteRule ^ /%1? [R=301,L]

# Servir les fichiers PHP et assets normalement
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Servir les dossiers normalement  
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Réécrire les URLs propres vers les fichiers .html (seulement pour les pages)
RewriteCond %{REQUEST_URI} ^/(essential|business|enterprise|contact)/?$
RewriteRule ^([^/]+)/?$ $1.html [L]

# Redirection spécifique pour la page d'accueil
RewriteRule ^home/?$ /index.html [NC,L]

# Pages principales
RewriteRule ^essential/?$ /essential.html [NC,L]
RewriteRule ^business/?$ /business.html [NC,L]
RewriteRule ^enterprise/?$ /enterprise.html [NC,L]
RewriteRule ^contact/?$ /contact.html [NC,L]

# Gestion des erreurs 404
ErrorDocument 404 /404.html

# Désactiver l'affichage du contenu des dossiers
Options -Indexes

# Cache et compression pour les performances
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"
</IfModule>

<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Sécurité
<Files ~ "^\.ht">
    Order allow,deny
    Deny from all
</Files>

# Empêcher l'accès aux fichiers de configuration
<Files "config.php">
    Order allow,deny
    Deny from all
</Files>

<Files "*.md">
    Order allow,deny
    Deny from all
</Files>